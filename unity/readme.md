# Unity Bot Mapper - 2D Visualisation System

A work in progress digital twin system for real time 2D visualisaton of autonomous robot trajectories with obstacle detection visualisation

## Table of Contents
1. [Overview](#overview)
2. [Key Features](#key-features)
3. [Installation & Setup](#installation--setup)
4. [Project Structure](#project-structure)
5. [Usage Guide](#usage-guide)
6. [Core Components](#core-components)
7. [Troubleshooting](#troubleshooting)

---

## Overview
This Unity application provides a replay of the mapper robot with obstacle detection. The system reads csv files generated by the python script from the microcontroller and creates an animated visualisation showing the robot's journey, detected obstacle and heading information.

### Architecture
```
CSV Data → Unity Loader → Coordinate Conversion → Animation System → Visualization
```
---

## Key Features
- Replay of Path Taken:  Smooth animation of robot movement along recorded GPS path.
- Dynamic Trail Rendering: Gradient-colored trail that builds as the robot moves.
- Obstacle Visualization: Red markers appear with heading orientation when obstacles are detected.
- Camera Following: Smooth Camera tracking.
- Coordinate Scaling: Conversion of lat and lon data into Unity world space.

## Installation & Setup

### 1. Unity Hub Installation
```bash
# Download [Unity Hub] from: (https://unity.com/download)
# Install Unity Editor 2022.3 LTS or higher
```

### 2. Project Setup
```bash
# Clone the repository
git clone [repository-url]
cd [folder name]

# OR extract from zip
unzip [name of zip]
cd unity/
```

### 3. Unity Configuration
1. **Open Unity Hub**
2. **Add Project**: Select the `/unity` folder
3. **Open Project**: Unity will automatically import assets
4. **Configure External Editor**:
   - Go to `Edit → Preferences → External Tools`
   - Set External Script Editor to your preferred IDE

### 4. Package Dependencies
Ensure these packages are installed via **Window → Package Manager**:
- **Visual Studio Editor** (for VS/VS Code integration)
- **2D Sprite** (for 2D rendering)
- **Mathematics** (for coordinate calculations)

### 5. Scene Setup
- Navigate to `Assets/Scenes/`
- Double-click `SampleScene.unity` to load the main scene
- Verify all GameObjects appear in Hierarchy

---

## Project Structure

```
unity/Assets/
├── Scenes/
│   └── SampleScene.unity           # Main visualization scene
├── Scripts/
│   ├── pathVisualiser.cs           # Core visualization controller
│   └── cameraFollow.cs             # Camera tracking system
├── Resources/
│   ├── path_data.csv               # Robot path data
│   └── obs_data.csv                # Obstacle detection data
├── Prefabs/
│   ├── botPrefab.prefab            # Robot representation
│   └── headingPrefab.prefab        # Obstacle direction indicator
├── Sprites/
│   ├── heading.png                 # Sprite for heading
└── └── bot.png                     # Sprite for bot
```

---

## Usage Guide

### 1. Preparing Data
Ensure your CSV files follow the correct format:

**path_data.csv:**
```csv
Latitude,Longitude,Heading
12.971642,77.594643,92
12.971645,77.594648,94
12.971648,77.594653,96
```

**obs_data.csv:**
```csv
Latitude,Longitude,Heading,Distance
12.971650,77.594647,180,25.4
12.971655,77.594652,175,22.8
```

### 2. Running the Visualization
1. **Load Scene**: Open `SampleScene.unity`
2. **Place Data**: Ensure CSV files are in `Assets/Resources/`
3. **Play Scene**: Click the Play button in Unity Editor
4. **Observe**: Watch the robot animate along the recorded path

---
## Core Components

### CameraFollow
Smooth camera tracking system that follows a target transform with configurable offset and interpolation speed.

**Key Methods:**
- `LateUpdate()` - Smoothly follows target position using linear interpolation

```csharp
public Transform target;
public Vector3 offset = new Vector3(0, 0, -10);
public float smoothSpeed = 0.125f;

void LateUpdate()
{
    Vector3 desiredPosition = target.position + offset;
    Vector3 smoothed = Vector3.Lerp(transform.position, desiredPosition, smoothSpeed);
    transform.position = smoothed;
}
```

### pathVisualiser
Main visualization component that loads GPS path data from CSV files, animates a bot along the path, and dynamically reveals obstacle arrows as the bot approaches them. Features real-time path rendering with LineRenderer.

**Key Methods:**
- `loadPathCSV()` - Parses GPS coordinates and converts them to Unity world space
- `loadObsCSV()` - Loads obstacle data and creates directional arrows
- `MoveBotAlongPath()` - Coroutine that smoothly moves bot along path points

```csharp
private List<Vector2> pathPoints = new List<Vector2>();
private List<Vector2> obsPoints = new List<Vector2>();
private float scale = 1e5f;

void loadPathCSV(string fileName)
{
    // Converts GPS coordinates to Unity world space
    float x = (lon - referencePoint.x) * scale;
    float y = (lat - referencePoint.y) * scale;
    pathPoints.Add(new Vector2(x, y));
}

IEnumerator MoveBotAlongPath()
{
    // Smoothly interpolates bot movement between path points
    Vector2 currentPos = Vector2.Lerp(start, end, t);
    bot.transform.position = currentPos;
    bot.transform.rotation = Quaternion.Euler(0, 0, -headings[currentIndex]);
}
```

## Troubleshooting

### Common Issues

#### 1. CSV Files Not Loading
**Problem**: "Cannot load CSV files" error
**Solutions**:
- Ensure files are in `Assets/Resources/` folder
- Check file naming (no extensions in LoadCSV calls)
- Verify CSV format matches expected structure
- Check for Windows vs Unix line endings

#### 2. Robot Not Moving
**Problem**: Bot prefab remains stationary
**Solutions**:
- Verify `pathPoints` list contains valid data
- Check coordinate scaling value (`scale = 1e5f`)
- Ensure bot prefab is properly instantiated
- Validate GPS coordinates are not zero/null

#### 3. Animation Performance Issues
**Problem**: Stuttering or low frame rate
**Solutions**:
- Reduce coordinate scale for smaller movements
- Limit obstacle count or revelation distance
- Optimize trail rendering (reduce vertices)
- Use object pooling for obstacle arrows

#### 4. Obstacles Not Appearing
**Problem**: Obstacle arrows don't show
**Solutions**:
- Check `obstacleRevealDistance` value (try 0.1f)
- Verify obstacle CSV data is valid
- Ensure arrow prefab is assigned correctly
- Check obstacle coordinate conversion

---